/*globals define, WebGMEGlobal*/
/*jshint browser: true*/

/**
 * Generated by VisualizerGenerator 0.1.0 from webgme on Wed Mar 16 2016 12:18:29 GMT-0700 (PDT).
 */

var TEMPLATES = {
    "Project.html.ejs": "<div id=\"<%= title %>-node-panel\" class=\"panel\">\n  <div class=\"panel-heading\">\n    <h3 class=\"panel-title\"><%= title %></h3>\n  </div>\n  <div class=\"panel-body\">\n    <div>\n      <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100\" height=\"100\" viewBox=\"0 0 8 8\">\n        <path d=\"M3 0c-.28 0-.54.1-.72.28-.18.18-.28.44-.28.72 0 .28.18.48.28.72.03.06.03.16.03.28h-2.31v6h2.31c0-.12-.01-.22-.03-.28-.1-.24-.28-.44-.28-.72 0-.28.1-.54.28-.72.18-.18.44-.28.72-.28.28 0 .54.1.72.28.18.18.28.44.28.72 0 .28-.18.48-.28.72-.03.06-.03.16-.03.28h2.31v-2.31c.12 0 .22.01.28.03.24.1.44.28.72.28.28 0 .54-.1.72-.28.18-.18.28-.44.28-.72 0-.28-.1-.54-.28-.72-.18-.18-.44-.28-.72-.28-.28 0-.48.18-.72.28-.06.03-.16.03-.28.03v-2.31h-2.31c0-.12.01-.22.03-.28.1-.24.28-.44.28-.72 0-.28-.1-.54-.28-.72-.18-.18-.44-.28-.72-.28z\"\n              fill=\"#039be5\"/>\n      </svg>\n    </div>\n    <span class=\"description\"><%= description %></span>\n  </div>\n</div>\n"
};

define([
    'text!./RootViz.html',
    'common/util/ejs',
    //'visualizer/widgets/RootViz/Templates',
    'css!./styles/RootVizWidget.css'
], function (
    RootVizHtml,
    ejs) {
    'use strict';

    var RootVizWidget,
        WIDGET_CLASS = 'root-viz';

    RootVizWidget = function (logger, container) {
        this._logger = logger.fork('Widget');

        this.$el = container;

        this.nodes = {};
        this._initialize();

        this._logger.debug('ctor finished');
    };

    RootVizWidget.prototype._initialize = function () {
        var width = this.$el.width(),
            height = this.$el.height(),
            self = this;

        // set widget class
        this.$el.addClass(WIDGET_CLASS);
        this.$el.append($(RootVizHtml));
    };

    RootVizWidget.prototype.onWidgetContainerResize = function (width, height) {
    };

    // Adding/Removing/Updating items
    var NODE_WHITELIST = {
        Project: true
    };
    RootVizWidget.prototype.addNode = function (desc) {
        if (desc) {
	    var isValid = NODE_WHITELIST[desc.meta],
	    column,
	    projectHtml,
	    title,
	    description,
	    htmlId,
	    html;

            if (isValid) {
		column = this.$el.find('#columnClass');

		title = desc.name;
		description = 'TEST DESCRIPTION';
		projectHtml = ejs.render(TEMPLATES['Project.html.ejs'], {title: title, description: description});

		column.append(projectHtml);

                htmlId = desc.name + '-node-panel';
                html = this.$el.find('#' + htmlId);

                html.addClass('panel-info');
                html.on('mouseenter', (event) => {
                    html.addClass('panel-primary');
                    html.removeClass('panel-info');
                });
                html.on('mouseleave', (event) => {
                    html.addClass('panel-info');
                    html.removeClass('panel-primary');
                });
                html.on('click', (event) => {
                    this.onNodeClick(desc.id);
                    event.stopPropagation();
                    event.preventDefault();
                });
            }
        }
    };

    RootVizWidget.prototype.removeNode = function (gmeId) {
	if (this.nodes[gmeId]) {
            delete this.nodes[gmeId];
	}
    };

    RootVizWidget.prototype.updateNode = function (desc) {
    };

    /* * * * * * * * Visualizer event handlers * * * * * * * */

    RootVizWidget.prototype.onNodeClick = function (id) {
        // This currently changes the active node to the given id and
        // this is overridden in the controller.
    };

    RootVizWidget.prototype.onBackgroundDblClick = function () {
    };

    /* * * * * * * * Visualizer life cycle callbacks * * * * * * * */
    RootVizWidget.prototype.destroy = function () {
    };

    RootVizWidget.prototype.onActivate = function () {
    };

    RootVizWidget.prototype.onDeactivate = function () {
    };

    return RootVizWidget;
});
